<!DOCTYPE html>
<html lang="no">                                                                          <!-- Norwegian as the language -->

<head>                                                                                    <!-- contains metadata and resources that aren’t displayed directly on the web page -->
    <meta charset="UTF-8">                                                                <!-- Sets the character encoding to UTF-8, which supports most characters from all known languages. -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">                <!-- Ensures the page is responsive by setting the viewport width to the device width and initial zoom to 1. -->
    <title>Info</title>                                                                  <!-- Sets the browser tab title -->
    <link rel="stylesheet" href="styles.css">                                              <!-- Links an external CSS file named style.css to style the HTML content -->
    <link rel="icon" type="image/png" href="Images/logo_svart.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://use.typekit.net/qsc8tmo.css">

</head>


<style>
  :root{
    --bg:#0b1020; --card:#12172a; --text:#e7eaf3; --muted:#a6aec9; --border:#232a46; --accent:#6ea8fe; --accent-2:#8dd0ff; --danger:#ff6b6b;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f6f7fb; --card:#ffffff; --text:#0e1320; --muted:#5a6178; --border:#e6e8f0; --accent:#4c7dff; --accent-2:#7fb6ff }
  }
  *{ box-sizing:border-box }
 

  .wrap{ min-height:100dvh; display:grid; place-items:center; padding:32px 16px }
  .card{ width:100%; max-width:800px; background:var(--card); border:1px solid var(--border); border-radius:18px; padding:24px; box-shadow:0 20px 50px rgba(0,0,0,.35);text-align:center;}
  h2{ margin:0 0 6px; font-weight:600; text-align:center;   font-family: "Comic Sans","Billion Miracles","Playfair Display";}
  .sub{ margin:0 0 18px; color:var(--muted) }

  .grid{
    display:grid;
    grid-template-columns: 1.2fr 1.2fr 1.5fr 0.8fr 1.6fr auto;
    gap:10px;
    align-items:center;
  }
  .th{ font-size:.9rem; color:var(--muted); padding:8px 6px }
  .row{ margin-top:8px }
  input[type="text"], select{
    width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#0e1430; color:var(--text); outline:none;
  }
  @media (prefers-color-scheme: light){ input[type="text"], select{ background:#fff } }
  input::placeholder{ color:color-mix(in oklab, var(--muted), transparent 25%) }
  input:focus, select:focus{
    border-color: color-mix(in oklab, var(--accent), white 10%);
    box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent), transparent 85%);
  }

  .btn{
    display:inline-flex; align-items:center; gap:.5ch; padding:10px 14px; border-radius:10px; cursor:pointer; border:1px solid transparent;
    background:#68a661; color:#071021; font-weight:600;
    box-shadow:0 10px 24px color-mix(in oklab, var(--accent), transparent 70%);
  }
  .btn.secondary{
    background:transparent; color:var(--text); border-color:var(--border);
  }
  .row .remove{
    border:1px solid var(--border); background:transparent; color:var(--muted); border-radius:10px; padding:8px 10px; cursor:pointer;
  }
  .row .remove:hover{ color:#fff; border-color:color-mix(in oklab, var(--danger), transparent 30%) }
  .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:16px }
  .fine{ margin-top:10px; color:var(--muted); font-size:.88rem }

  .error{ margin-top:10px; color:var(--danger); font-weight:600; display:none }
  .success{ margin-top:10px; color:#17c964; font-weight:600; display:none }

  .th {white-space: nowrap;} /* keeps header text on one line */

</style>
<body>   
    <nav class="navbar">    
                                                                     <!-- tells the browser (and screen readers, search engines, etc.) that the content inside is a navigation menu—typically links to main sections of the website-->
        <div class="navbar__container"> 
            <a href="./index.html" class="navbar_logo_links">                                           <!-- It’s a block-level container used to group elements together for styling or scripting (via CSS or JavaScript). -->
                <img src="Images/logo_navbar.jpg" alt="Logo_navbar" class="navbar_logo"> 
            </a>
            <ul class="navbar__menu">
                
                <li class="navbar__item">
                    <a href="./index.html" class="navbar__links">
                        HJEM
                    </a>
                </li>
                <li class="navbar__item">
                    <a href="./info.html" class="navbar__links">
                        INFO OM DAGEN
                    </a>
                </li>
                <li class="navbar__item">
                    <a href="./overnatting.html" class="navbar__links">
                        OVERNATTING
                    </a>
                </li>
                <li class="navbar__item">
                    <a href="./gavetips.html" class="navbar__links">
                        GAVETIPS
                    </a>
                </li>
                <li class="navbar__item">
                    <a href="./spill.html" class="navbar__links">
                        SPILL
                    </a>
                </li>
                <li class="navbar__item">
                    <a href="./FAQ.html" class="navbar__links">
                        FAQ
                    </a>
                </li>
                <li class="navbar__btn">
                    <a href="./RSVP.html" class="button">
                        RSVP
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    
    <div class="wrap">
        <form id="rsvp-form" class="card" novalidate>
            <h2>RSVP</h2>
            <p class="sub">Her kan du svare på om du kommer eller ikke i bryllupet, samt eventuelle allergier som må tas hensyn til. Du kan svare for flere personer. Mer info om overnatting finner du på <a href="./overnatting.html" class="navbar__links">
                        Overnatting
                    </a> siden.</p>

            <!-- Header -->
            <div class="grid">
                <div class="th">Fornavn</div>
                <div class="th">Etternavn</div>
                <div class="th">Allergi</div>
                <div class="th">Deltar?</div>
                <div class="th">Tenker du å bestille overnatting<br> på Strand hotell?</div>
                <div class="th" aria-hidden="true"></div>
            </div>

            <!-- Dynamic rows container -->
            <div id="rows"></div>

            <!-- Controls -->
            <div class="actions">
                <button type="button" id="addRow" class="btn secondary">+ Legg til person</button>
                <button type="submit" class="btn">Send inn</button>
            </div>

            <div id="error" class="error">Vennligst fyll ut fornavn, etternavn og deltakelse for alle rader.</div>
            <div id="success" class="success">Takk! Svaret er lagret.</div>
        </form>
    </div>

    <div class="countdown-container">
        <p class="countdown-label">Tid igjen til bryllup:</p>
        <div class="countdown"></div>
    </div> 
    
    <script src="app.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

        const app = initializeApp({
        apiKey: "AIzaSyCS76udSJAebNHNaNTcvGVOdvLnU_1LJiI",
        authDomain: "kartnettside.firebaseapp.com",
        databaseURL: "https://kartnettside-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "kartnettside",
        storageBucket: "kartnettside.firebasestorage.app",
        messagingSenderId: "495949813180",
        appId: "1:495949813180:web:9f74f5c0e9dfef1f03c7b9",
        measurementId: "G-W7JZWMQ4ZY"
        });
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const rowsEl = document.getElementById("rows");
        const addRowBtn = document.getElementById("addRow");
        const form = document.getElementById("rsvp-form");
        const errorEl = document.getElementById("error");
        const successEl = document.getElementById("success");

        // Helpers
        function makeRow(data = {}) {
            const row = document.createElement("div");
            row.className = "grid row";
            row.innerHTML = `
            <input type="text" class="firstName" placeholder="Kari" value="${escapeAttr(data.firstName || "")}" required>
            <input type="text" class="lastName" placeholder="Nordmann" value="${escapeAttr(data.lastName || "")}" required>
            <input type="text" class="allergy" placeholder="Peanøtter / &quot;ingen&quot;" value="${escapeAttr(data.allergy || "")}">
            <select class="attending" required>
                <option value="">-- velg --</option>
                <option value="yes"${data.attending === true ? " selected" : ""}>Ja</option>
                <option value="no"${data.attending === false ? " selected" : ""}>Nei</option>
            </select>
            <select class="overnatting">
                <option value="">-- velg --</option>
                <option value="ja"${data.overnatting === "ja" ? " selected" : ""}>Ja</option>
                <option value="nei"${data.overnatting === "nei" ? " selected" : ""}>Nei</option>
                <option value="usikker"${data.overnatting === "usikker" ? " selected" : ""}>Usikker</option>
            </select>
            <button type="button" class="remove" title="Fjern rad">Fjern</button>
            `;
            row.querySelector(".remove").addEventListener("click", () => {
            row.remove();
            ensureAtLeastOneRow();
            });
            return row;
        }

        function escapeAttr(s){ return String(s).replaceAll("&","&amp;").replaceAll('"',"&quot;").replaceAll("<","&lt;").replaceAll(">","&gt;") }

        function ensureAtLeastOneRow(){
            if (!rowsEl.children.length) rowsEl.appendChild(makeRow());
        }

        addRowBtn.addEventListener("click", () => {
            rowsEl.appendChild(makeRow());
            // focus first name in the new row
            rowsEl.lastElementChild.querySelector(".firstName").focus();
        });

        // Start with two rows (as you asked for a second row option)
        rowsEl.appendChild(makeRow());
        


        onAuthStateChanged(auth, (user) => {
            if (!user) {
            // not signed in → send back to login
            window.location.replace("./Login.html");
            return;
            }
        

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            errorEl.style.display = "none";
            successEl.style.display = "none";

            // Collect rows
            const rows = Array.from(rowsEl.querySelectorAll(".row")).map(row => {
                const firstName = row.querySelector(".firstName").value.trim();
                const lastName  = row.querySelector(".lastName").value.trim();
                const allergy   = row.querySelector(".allergy").value.trim();
                const attVal    = row.querySelector(".attending").value;
                const attending = attVal === "yes" ? true : (attVal === "no" ? false : null);
                const overnatting = row.querySelector(".overnatting").value || null; // "ja" | "nei" | "usikker" | null
                return { firstName, lastName, allergy, attending };
            });

            // Validate: must have at least one complete row
            const valid = rows.length > 0 && rows.every(r => r.firstName && r.lastName && typeof r.attending === "boolean");
            if (!valid) {
                errorEl.style.display = "block";
                return;
            }

            try {
                // Write ONE document per submission with all people
                await addDoc(collection(db, "events", "wedding1", "rsvps"), {
                people: rows,
                respondedAt: serverTimestamp()
                });

                // Clear + show success
                rowsEl.innerHTML = "";
                rowsEl.appendChild(makeRow());
                form.reset(); // resets selects in case browser keeps state
                successEl.style.display = "block";
            } catch (err) {
                console.error(err);
                errorEl.textContent = "Kunne ikke lagre. Prøv igjen.";
                errorEl.style.display = "block";
            }
            });
        });
    </script>
</body>
</html>